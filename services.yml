---
apiVersion: v1
kind: Secret
metadata:
  name: bowsecret-tls
  namespace: default
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZZekNDQkV1Z0F3SUJBZ0lTQTQ5UHJIVGwyWStCN1JBNDVCeU1yVkZlTUEwR0NTcUdTSWIzRFFFQkN3VUEKTURJeEN6QUpCZ05WQkFZVEFsVlRNUll3RkFZRFZRUUtFdzFNWlhRbmN5QkZibU55ZVhCME1Rc3dDUVlEVlFRRApFd0pTTXpBZUZ3MHlNVEExTVRRd09EVXdOVFphRncweU1UQTRNVEl3T0RVd05UWmFNQ1F4SWpBZ0JnTlZCQU1UCkdXcGxibXRwYm5NdVltOXZlbVZ2Ym5kb1pXVnNjeTVqYjIwd2dnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUIKRHdBd2dnRUtBb0lCQVFDM3hFamo4blQyaHY5aUVPdVpueTRSdTJRTXNHQ0tmL1N0WGM5cVh3Vmx4cFhMR0F6cQo4d3I5RmpSbWZJWnJGYTZtbkcxdHdRUHZwNXRCMUczN3B3VThpeGRUbHdLTExuYzJEcTJ5WVlxeE5DM0p2bFhDCkZEanJzVFFneUhMME9jQWVUL2pqOWR0WmVVeEU4WFJ5cy9mSzRScFJCUWl2a3BGL0xqeUtQZUE1NFdGMDVsdjcKOHdiQnFVRXkrYUpMNFIyRWFHd0FkQ3dqaUV3Q1VFRDJMOXRRNi9jS3VzeFMzZDdDaThpRHhnWmV5QnNKdHdCTApPd0UxU2t0OGNISFNrR0pwUnZnRFVLQXVFRzRRUTVGV2JJWURlT05kRHpDMlBVSC9yM3pJeGQwWEk4Tko2U0hUCnZJTXlnREhnSGhVUStuVlBSYkNlenc0VjI1Y1ZvUnVIUVBDTEFnTUJBQUdqZ2dKL01JSUNlekFPQmdOVkhROEIKQWY4RUJBTUNCYUF3SFFZRFZSMGxCQll3RkFZSUt3WUJCUVVIQXdFR0NDc0dBUVVGQndNQ01Bd0dBMVVkRXdFQgovd1FDTUFBd0hRWURWUjBPQkJZRUZKajhuRFZpa2dTa09QR00wakJjbTc4dU5ZNktNQjhHQTFVZEl3UVlNQmFBCkZCUXVzeGUzV0ZiTHJsQUpRT1lmcjUyTEZNTEdNRlVHQ0NzR0FRVUZCd0VCQkVrd1J6QWhCZ2dyQmdFRkJRY3cKQVlZVmFIUjBjRG92TDNJekxtOHViR1Z1WTNJdWIzSm5NQ0lHQ0NzR0FRVUZCekFDaGhab2RIUndPaTh2Y2pNdQphUzVzWlc1amNpNXZjbWN2TUU0R0ExVWRFUVJITUVXQ0VXSnZiM3BsYjI1M2FHVmxiSE11WTI5dGdobHFaVzVyCmFXNXpMbUp2YjNwbGIyNTNhR1ZsYkhNdVkyOXRnaFYzZDNjdVltOXZlbVZ2Ym5kb1pXVnNjeTVqYjIwd1RBWUQKVlIwZ0JFVXdRekFJQmdabmdRd0JBZ0V3TndZTEt3WUJCQUdDM3hNQkFRRXdLREFtQmdnckJnRUZCUWNDQVJZYQphSFIwY0RvdkwyTndjeTVzWlhSelpXNWpjbmx3ZEM1dmNtY3dnZ0VGQmdvckJnRUVBZFo1QWdRQ0JJSDJCSUh6CkFQRUFkd0JjM0VPUy91YXJSVVN4WHByVVZ1WVFOL3ZWK2tmY29YT1VzbDdtOXNjT3lnQUFBWGxxU1VRcEFBQUUKQXdCSU1FWUNJUUQ0bXNTN1BTT0VhS0FHY1VMMXlFM2libWF3amt0M1lXbnZBeVE4Zk40SjJRSWhBTlcrSjZDbgo1UW9DdzlXbUwwZDMvNG1SYXdMeU91dkZkWnp0V2JwdzJucW5BSFlBZlQ3eStJLy9pRlZvSk1MQXlwNVNpWGtyCnhRNTRDWDh1YXBkb21YNGk4TmNBQUFGNWFrbEVhUUFBQkFNQVJ6QkZBaUI0bGsyaERhVUFwWFI0SGErM2xyZG0Kcmx5elNGV2h3eHNFZ3JXTzBWaEo3Z0loQUxXd3I0UlZoQ0kvRDFhbnVVc2QraDVXZzE1bjF0akx4a0xCUmNtZQplS0IwTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCQVFDQTJYbWtWNFd2WkZDVGhsRG4xdk83N1g1cXZSSHRKblRLClFJQWNlL3ozV1k3bmJYaVJVeWM2NmtId1gzSlNWK2Q3UmRFNnJONXR2cEdEOU9WU3ZSRjdoMkI2aHpJR0NNMmMKYmtwL3kvSktrUERxTFBYcXlrZWdKQWpnUCswalduN0cvYmhrTllqY2pDOVVWazcyVjkxc1dEbzIrVWxqU2ZneAplY0pNVXdWZ0QrSHpYMExJZllWYyt6MUM3TElNd0trS0RJKzhmSnJrR1BsMU05SnJMYk1VdW1YMEdza1VqbUpWCjR3akprRndZUVIyaGR2elVFQTF1ekg3SEVGSHRsU0xIVjdvelAvT05tTU9hMWtQR3lIZmQrVDVNL2x5eVNmZVUKa0hycXhEdTJvTHNwNjFGU2NsazdETzNqeGJzUXFlcmdrakUybnR5dlNVRlpyV090c1ZwZgotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRQzN4RWpqOG5UMmh2OWkKRU91Wm55NFJ1MlFNc0dDS2YvU3RYYzlxWHdWbHhwWExHQXpxOHdyOUZqUm1mSVpyRmE2bW5HMXR3UVB2cDV0QgoxRzM3cHdVOGl4ZFRsd0tMTG5jMkRxMnlZWXF4TkMzSnZsWENGRGpyc1RRZ3lITDBPY0FlVC9qajlkdFplVXhFCjhYUnlzL2ZLNFJwUkJRaXZrcEYvTGp5S1BlQTU0V0YwNWx2Nzh3YkJxVUV5K2FKTDRSMkVhR3dBZEN3amlFd0MKVUVEMkw5dFE2L2NLdXN4UzNkN0NpOGlEeGdaZXlCc0p0d0JMT3dFMVNrdDhjSEhTa0dKcFJ2Z0RVS0F1RUc0UQpRNUZXYklZRGVPTmREekMyUFVIL3Izekl4ZDBYSThOSjZTSFR2SU15Z0RIZ0hoVVErblZQUmJDZXp3NFYyNWNWCm9SdUhRUENMQWdNQkFBRUNnZ0VBTVRsMzJPOXlXek1RSjZHbXFuRFVNMVhCMkJCSzIrNm9pT1B2RW13L2t1S2QKNzFnUzVjQ1N1ZlovdE5BNFpXamFickRLTXpNWHJkTjBxQzZTQTIzYTNqdlgxTUZIb2lhaE1pNitZbUQwZU1FawpYcjBJVmNONjk4OXd5ak5IYjVva2x6b096bWxtQjFLUmxvb2pDaktnOW94VHMwNG81SGJiV0hqM0tJU29rbmdTCjd2MUxpSzBHRTVIN1J5NS9KdkdiZ1U5TytqZlYwWVU0bE5FY1JYcEo4TG1FVUxvbk5HQ2E3amxjK0FiNEtvd3cKd2RMZno5a1ZxZSszYllhaVFKYjZUUUR5OUpzVkk3MzJibEZJc1NUeFJMWkk3MThtazloaGhhVTNBT1EwZUp2LwpjWERIeG1zaWJmNVd6anRxUFZYTzRVdHZSMVM4aitlYXhJVXQ2aytFNFFLQmdRRHlHTUZtY1M3dDVLOWsrSzIvCkQ3em1LSHhQbkUwRGMzb3hjTWN0bkFSaUtMaXMzc050dSs0ajc1Z1U3WStDM2pBRWNVTkVXRFUwdTFoQVhhanQKVjl1R1IxMndyQTZVcHlySldjcm5QcVZlV2p3Wnl1MFp1VURKeFlUSmZFUDhlN0pjbmpjRGh1K0lieTU4cGRUNQp2NTlFcGt0SUtUMlVqR2R3Y1BCUWRnNEhFUUtCZ1FEQ1Vmb1VDUFQzcmNWVjMrTUE4cmlMbXRJRXFFMEQ0K2ttClRwcnNiOWlmWkkwNGpWOUZ3eFRIc0VGZHluTUFCRXpaK1pCZGkzRmx0aU15VUtxQVJyYzFsVkMrYWxpakxPZk0Kay9HT0lhdWQzN0luaUUyYS9jSjd1Z2czb3J0bXA0b3c0aFlNL01XZUVyMTZNRHdmQm9SVEtVMDZ5aDVuWnJjWApLMUc0MU9TVjJ3S0JnSGhLQ3BaTytJVmxVaXkyVHdZVzJNSDNMY1VVb1VOc3RqTW9tUjYxWFl3ME5ZWlhiUHp5CkdxSXFZd05MQWpxQkVaU3pmanZRSkNlZVNudzR6VDJZb00rNFYvbjNrNHNUQUhScE5DTHdBcFM5K3d6SndrTTgKdzg4OVgvd0l6WEwvTnlGRHo0dm1HTkJPaGVlVE1oNGhzdzRXSG1PdGNoYUVLTVU2cUgwaUcxZ3hBb0dBQlBzMAovZTU4MlJ5TFFuaEt5V3R2YjZTNFhZWXk4emFVYzNid1liODhQbG5GaFAyYXc1OE1tVkhiV3h3bGRvcWxyYkRJCkVwM1FlbHNBNi9sRlphUnFiZVUxL0t1ZE9oR2NuNUhyVDBsdHJNNWZNc1E3dVExb1B1TzE4amNwdHFmMDB1djQKeEx4MkZHZEdsQ3RJWDBNN2dTWTk1SlBwMDV5K2RNbVhmclYyWnFFQ2dZRUFzckNDU2RBZW1VVVYyVnpHdklpTgpGTGJSKy9YOHNVcndKLzk5Rmk0am1IZVQ0b3pPemd0NXFtRWprR0VqZnJIT3h4RThMTG5Qc1NCQ2YxR2VnLzJMCjh1bnFrK1JSd01zR3NMWjdadllsSkFEMGpBQ1YrckY0RFRjc3dmVUFScE5VZ2ZxZGtFRHFGOGp1WmZ5c1h5N2QKb2VpQWF0cjRhYTVzUkdtaVFPMFh4ZGM9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0=
type: kubernetes.io/tls
---
apiVersion: v1
data:
  FILE_PATH: /data/files
  AWS_ENDPOINT_URL: "https://s3.ap-south-1.amazonaws.com"
  AWS_ACCESS_KEY: "AKIAVAGJA4ISYFVAOQMC"
  AWS_SECRET_KEY: "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"
  AWS_BUCKET_NAME: "bow-sg"
  MONGO_URL: "mongodb://admin:password@mongo:27017/boozeonwheel?authSource=admin"
kind: ConfigMap
metadata:
  name: bow-api-config
  namespace: default
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: bow-api-app
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: bow-api-app
  template:
    metadata:
      labels:
        app: bow-api-app
    spec:
      volumes:
      - name: mypd
        persistentVolumeClaim:
          claimName: mongo-persistent-storage
      containers:
        -
          env:

            -
              name: FILE_PATH
              valueFrom:
                configMapKeyRef:
                  key: FILE_PATH
                  name: bow-api-config
            -
              name: AWS_ENDPOINT_URL
              valueFrom:
                configMapKeyRef:
                  key: AWS_ENDPOINT_URL
                  name: bow-api-config

            -
              name: AWS_ACCESS_KEY
              valueFrom:
                configMapKeyRef:
                  key: AWS_ACCESS_KEY
                  name: bow-api-config
            -
              name: AWS_SECRET_KEY
              valueFrom:
                configMapKeyRef:
                  key: AWS_SECRET_KEY
                  name: bow-api-config

            -
              name: AWS_BUCKET_NAME
              valueFrom:
                configMapKeyRef:
                  key: AWS_BUCKET_NAME
                  name: bow-api-config
            -
              name: MONGO_URL
              valueFrom:
                configMapKeyRef:
                  key: MONGO_URL
                  name: bow-api-config

          image: "lalit1980/bow-product-svc:tagVersion"
          volumeMounts:
          - mountPath: "/data/files"
            name: mypd
          imagePullPolicy: Always
          name: bow-api-app
          ports:
            -
              containerPort: 9010
      restartPolicy: Always
---
apiVersion: v1
kind: Service
metadata:
  name: bow-api-service
  namespace: default
spec:
  clusterIP: None
  ports:
    - port: 9010 # custom value.
  selector:
    app: bow-api-app
---
apiVersion: cert-manager.io/v1alpha2
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
  namespace: cert-manager
spec:
  acme:
    # The ACME server URL
    server: https://acme-v02.api.letsencrypt.org/directory
    # Email address used for ACME registration
    email: lalit.yadav@boozeonwheels.co
    # Name of a secret used to store the ACME account private key
    privateKeySecretRef:
      name: letsencrypt-prod
    # Enable the HTTP-01 challenge provider
    solvers:
    - http01:
        ingress:
          class: nginx
---
apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: bow-ingress
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
spec:
  tls:
  - hosts:
    - boozeonwheels.com
    secretName: bowsecret-tls
  rules:
  - host: boozeonwheels.com
    http:
      paths:
      - backend:
          serviceName: bow-api-service
          servicePort: 9010
