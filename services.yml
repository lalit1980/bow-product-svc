---
apiVersion: v1
kind: Secret
metadata:
  name: bowsecret-tls
  namespace: default
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZZekNDQkV1Z0F3SUJBZ0lTQTQ5UHJIVGwyWStCN1JBNDVCeU1yVkZlTUEwR0NTcUdTSWIzRFFFQkN3VUEKTURJeEN6QUpCZ05WQkFZVEFsVlRNUll3RkFZRFZRUUtFdzFNWlhRbmN5QkZibU55ZVhCME1Rc3dDUVlEVlFRRApFd0pTTXpBZUZ3MHlNVEExTVRRd09EVXdOVFphRncweU1UQTRNVEl3T0RVd05UWmFNQ1F4SWpBZ0JnTlZCQU1UCkdXcGxibXRwYm5NdVltOXZlbVZ2Ym5kb1pXVnNjeTVqYjIwd2dnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUIKRHdBd2dnRUtBb0lCQVFDM3hFamo4blQyaHY5aUVPdVpueTRSdTJRTXNHQ0tmL1N0WGM5cVh3Vmx4cFhMR0F6cQo4d3I5RmpSbWZJWnJGYTZtbkcxdHdRUHZwNXRCMUczN3B3VThpeGRUbHdLTExuYzJEcTJ5WVlxeE5DM0p2bFhDCkZEanJzVFFneUhMME9jQWVUL2pqOWR0WmVVeEU4WFJ5cy9mSzRScFJCUWl2a3BGL0xqeUtQZUE1NFdGMDVsdjcKOHdiQnFVRXkrYUpMNFIyRWFHd0FkQ3dqaUV3Q1VFRDJMOXRRNi9jS3VzeFMzZDdDaThpRHhnWmV5QnNKdHdCTApPd0UxU2t0OGNISFNrR0pwUnZnRFVLQXVFRzRRUTVGV2JJWURlT05kRHpDMlBVSC9yM3pJeGQwWEk4Tko2U0hUCnZJTXlnREhnSGhVUStuVlBSYkNlenc0VjI1Y1ZvUnVIUVBDTEFnTUJBQUdqZ2dKL01JSUNlekFPQmdOVkhROEIKQWY4RUJBTUNCYUF3SFFZRFZSMGxCQll3RkFZSUt3WUJCUVVIQXdFR0NDc0dBUVVGQndNQ01Bd0dBMVVkRXdFQgovd1FDTUFBd0hRWURWUjBPQkJZRUZKajhuRFZpa2dTa09QR00wakJjbTc4dU5ZNktNQjhHQTFVZEl3UVlNQmFBCkZCUXVzeGUzV0ZiTHJsQUpRT1lmcjUyTEZNTEdNRlVHQ0NzR0FRVUZCd0VCQkVrd1J6QWhCZ2dyQmdFRkJRY3cKQVlZVmFIUjBjRG92TDNJekxtOHViR1Z1WTNJdWIzSm5NQ0lHQ0NzR0FRVUZCekFDaGhab2RIUndPaTh2Y2pNdQphUzVzWlc1amNpNXZjbWN2TUU0R0ExVWRFUVJITUVXQ0VXSnZiM3BsYjI1M2FHVmxiSE11WTI5dGdobHFaVzVyCmFXNXpMbUp2YjNwbGIyNTNhR1ZsYkhNdVkyOXRnaFYzZDNjdVltOXZlbVZ2Ym5kb1pXVnNjeTVqYjIwd1RBWUQKVlIwZ0JFVXdRekFJQmdabmdRd0JBZ0V3TndZTEt3WUJCQUdDM3hNQkFRRXdLREFtQmdnckJnRUZCUWNDQVJZYQphSFIwY0RvdkwyTndjeTVzWlhSelpXNWpjbmx3ZEM1dmNtY3dnZ0VGQmdvckJnRUVBZFo1QWdRQ0JJSDJCSUh6CkFQRUFkd0JjM0VPUy91YXJSVVN4WHByVVZ1WVFOL3ZWK2tmY29YT1VzbDdtOXNjT3lnQUFBWGxxU1VRcEFBQUUKQXdCSU1FWUNJUUQ0bXNTN1BTT0VhS0FHY1VMMXlFM2libWF3amt0M1lXbnZBeVE4Zk40SjJRSWhBTlcrSjZDbgo1UW9DdzlXbUwwZDMvNG1SYXdMeU91dkZkWnp0V2JwdzJucW5BSFlBZlQ3eStJLy9pRlZvSk1MQXlwNVNpWGtyCnhRNTRDWDh1YXBkb21YNGk4TmNBQUFGNWFrbEVhUUFBQkFNQVJ6QkZBaUI0bGsyaERhVUFwWFI0SGErM2xyZG0Kcmx5elNGV2h3eHNFZ3JXTzBWaEo3Z0loQUxXd3I0UlZoQ0kvRDFhbnVVc2QraDVXZzE1bjF0akx4a0xCUmNtZQplS0IwTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCQVFDQTJYbWtWNFd2WkZDVGhsRG4xdk83N1g1cXZSSHRKblRLClFJQWNlL3ozV1k3bmJYaVJVeWM2NmtId1gzSlNWK2Q3UmRFNnJONXR2cEdEOU9WU3ZSRjdoMkI2aHpJR0NNMmMKYmtwL3kvSktrUERxTFBYcXlrZWdKQWpnUCswalduN0cvYmhrTllqY2pDOVVWazcyVjkxc1dEbzIrVWxqU2ZneAplY0pNVXdWZ0QrSHpYMExJZllWYyt6MUM3TElNd0trS0RJKzhmSnJrR1BsMU05SnJMYk1VdW1YMEdza1VqbUpWCjR3akprRndZUVIyaGR2elVFQTF1ekg3SEVGSHRsU0xIVjdvelAvT05tTU9hMWtQR3lIZmQrVDVNL2x5eVNmZVUKa0hycXhEdTJvTHNwNjFGU2NsazdETzNqeGJzUXFlcmdrakUybnR5dlNVRlpyV090c1ZwZgotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t
  tls.key: MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCxB3Wthmn6rGkD5SYd4q9c8Qb//BKPSQZMQxpktU3BuS9N4ggVXPAVesyuA7HWGTGeMrX5T710bQcPu++ttTOhmIR24vl3TsnanR+1L6VNT2Lq6wYA4OEP38R4BRmK2nuQnlwG5ZqF+FeIkD9UkdfdoB3ZP5J3tt3LSnkhi1LUeEEDRLoGlZOFG83OBot+g1C5zBDe4atDb2KpEpp+k/InYI7e+HT0HMGyFUnC0nW3MIjbbLXrCNbGEtw9O9qg+z4DuwTlOdVv/x7etqvGOL8hAg3T4s7kVsrAXWeOBoYlq0Xry5hdp2JPWXFPva65z3+RbCT0A0aURQ85qmwCr5NRAgMBAAECggEALXFDxOpnFADj6CsPUMaay1nXuShEv2E4a6UiBk4ACsV1niFyf8Feo7TlC5pJMTNAaGKOEdRlRpiiImjUyptkCIw1HKuA7B5edG627/SuEx1YwALahKk1PLTtIv30I4+X/nSYHPEdbFxmY9jbWOMjLXHnl5fZCj/3yTJxy6mO9pkGiMF8XlMIGZ1YHrgt4my+7wCSIGox18CVYQcL1Xub16aPGD0gRqWTrsngb3I0KkOV+FSWR5dnCvMwKvWyARFPhV2HMz+mvvJfHcGByllsMKMGjGje39cUkxD8T6w10JMDwT7wM8n7jK6bZYMJruo5rBW9hTQ4aGadwNKxmoRtLQKBgQDbBGL6iieBJgEgm8JD7AA+e3yGLGRfo7vP1qOIksiMnTw8KmyKDpZ9RbOQ/kB3HAL/TjgJ0o3oQ97jD5Pe5/3oKAmpNOjbC4bJI/1XAwWhiWq6CjSTyxHm5rOr5KT4m5LQnsNmni/81Xe2uPkemwIPoVR6f7R8A2E1C+yEScfDQwKBgQDO7Ab/ej9wipK6xOkx8Hv1l9dmSFQ0cuFQiqHh7tixCzGBTbhb/qaB9Nd0TOwlxK3cZUhLEVFVT6HudpBtcd/hite+IfIk6mU4lh3wd7vpG16MgtpjFC/t962bktoBXH3zzExzv9QrvzWPP5TefWzAyE7pFuSYjXc+i4jCjvtD2wKBgQC9eLYH+KzkVXR0OUt+ZxRu+XVovc63znYT/6PJ6vIEc6JAipMLfENEbKBDtzEd2eXd6FUiajzJyq1v0XIjTJ+jz79L2rH3jak1KSVpuPuOG8tw1pNVqD/8eWjGNC9jw3Lnd/GjPQZWvHWsZaleiMrnqrHip8gD4QifU4lxiEKA8QKBgQC9+5+BObC9l72Yleq122M03rD6TDZj4YZV+LMhSbbS9sABRGacsHYYo8CeG3JGSwqGbMevhLr0ZST8WQfKNN+lqWDkRS6aDkvZZJsgig6RvHtW712r0oEfMGTJjk9zKITMLyuSqvIXKHv4hhwdG3OanU82W7qPBnQRjPOIDtdMOQKBgAIGF6XcIHVIf3FrUa9ufNI654Yzu7RsrF1UPtkZQVecVYIOyNV/sLAnThaFUX1GjotoIjpQgaoe8IjvUQZgPr2H/s1W6/K+TJpqFicYT+40C1+qXSzY8NQ9tJxrCzFJ+PZxe7l1jkC2ivaHKzpce3IrW6IQoueAMpFoOoasVAgu
type: kubernetes.io/tls
---
apiVersion: v1
data:
  FILE_PATH: /data/files
  AWS_ENDPOINT_URL: "https://s3.ap-south-1.amazonaws.com"
  AWS_ACCESS_KEY: "AKIAVAGJA4ISYFVAOQMC"
  AWS_SECRET_KEY: "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"
  AWS_BUCKET_NAME: "bow-sg"
  MONGO_URL: "mongodb://admin:password@mongo:27017/boozeonwheel?authSource=admin"
kind: ConfigMap
metadata:
  name: bow-api-config
  namespace: default
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: bow-api-app
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: bow-api-app
  template:
    metadata:
      labels:
        app: bow-api-app
    spec:
      volumes:
      - name: mypd
        persistentVolumeClaim:
          claimName: mongo-persistent-storage
      containers:
        -
          env:

            -
              name: FILE_PATH
              valueFrom:
                configMapKeyRef:
                  key: FILE_PATH
                  name: bow-api-config
            -
              name: AWS_ENDPOINT_URL
              valueFrom:
                configMapKeyRef:
                  key: AWS_ENDPOINT_URL
                  name: bow-api-config

            -
              name: AWS_ACCESS_KEY
              valueFrom:
                configMapKeyRef:
                  key: AWS_ACCESS_KEY
                  name: bow-api-config
            -
              name: AWS_SECRET_KEY
              valueFrom:
                configMapKeyRef:
                  key: AWS_SECRET_KEY
                  name: bow-api-config

            -
              name: AWS_BUCKET_NAME
              valueFrom:
                configMapKeyRef:
                  key: AWS_BUCKET_NAME
                  name: bow-api-config
            -
              name: MONGO_URL
              valueFrom:
                configMapKeyRef:
                  key: MONGO_URL
                  name: bow-api-config

          image: "lalit1980/bow-product-svc:tagVersion"
          volumeMounts:
          - mountPath: "/data/files"
            name: mypd
          imagePullPolicy: Always
          name: bow-api-app
          ports:
            -
              containerPort: 9010
      restartPolicy: Always
---
apiVersion: v1
kind: Service
metadata:
  name: bow-api-service
  namespace: default
spec:
  clusterIP: None
  ports:
    - port: 9010 # custom value.
  selector:
    app: bow-api-app
---
apiVersion: cert-manager.io/v1alpha2
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
  namespace: cert-manager
spec:
  acme:
    # The ACME server URL
    server: https://acme-v02.api.letsencrypt.org/directory
    # Email address used for ACME registration
    email: lalit.yadav@boozeonwheels.co
    # Name of a secret used to store the ACME account private key
    privateKeySecretRef:
      name: letsencrypt-prod
    # Enable the HTTP-01 challenge provider
    solvers:
    - http01:
        ingress:
          class: nginx
---
apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: bow-ingress-api-svc
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
spec:
  tls:
  - hosts:
    - boozeonwheels.com
    secretName: bowsecret-tls
  rules:
  - host: boozeonwheels.com
    http:
      paths:
      - path: /swagger
        backend:
          serviceName: bow-api-service
          servicePort: 9010
